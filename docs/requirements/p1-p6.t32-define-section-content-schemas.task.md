# T32: Define Section Content Schemas

## 1 Meta & Governance

### 1.2 Status

- **Current State:** ðŸ’¡ Not Started
- **Priority:** ðŸŸ¥ High
- **Progress:** 0%
- **Planning Estimate:** 5
- **Est. Variance (pts):** 0
- **Created:** 2025-08-03 06:13
- **Implementation Started:**
- **Completed:**
- **Last Updated:** 2025-08-03 21:35

### 1.3 Priority Drivers

- [TEC-Prod_Stability_Blocker](../ddd-2.md#tec-prod_stability_blocker)
- [TEC-Dev_Productivity_Enhancement](../ddd-2.md#tec-dev_productivity_enhancement)

---

## 2 Business & Scope

### 2.1 Overview

- **Core Function**: This task is to create the canonical Zod schemas that define the expected content structure for each section within a `*.plan.md` or `*.task.md` document.
- **Key Capability**: It will produce one or more `*.ts` files that export Zod schemas for validating the parsed content of markdown sections (e.g., ensuring a "Status" section contains the correct bullet points).
- **Business Value**: Enables automated validation of documentation content, guaranteeing that all documents are structurally correct and can be reliably parsed by tools and LLMs. This prevents runtime errors in downstream tooling.

### 2.4 Acceptance Criteria

| ID   | Criterion                                                                                                                                                       | Test Reference                           |
| :--- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------- |
| AC-1 | A directory `src/doc-parser/validation/` is created to house all schema-related files.                                                                          | N/A                                      |
| AC-2 | For each of the 8 documentation families, a corresponding `[family-name].schema.ts` file is created (e.g., `1-meta-governance.schema.ts`).                      | `__tests__/[family-name].schema.test.ts` |
| AC-3 | Each `[family-name].schema.ts` file exports a main Zod schema that validates the content structure for all sections within that family.                         | `__tests__/[family-name].schema.test.ts` |
| AC-4 | A `__tests__` directory is created inside `src/doc-parser/validation/` to hold all test files.                                                                  | N/A                                      |
| AC-5 | For each of the 8 documentation families, a corresponding `[family-name].schema.test.ts` file is created inside the `__tests__` directory.                      | N/A                                      |
| AC-6 | Each test file contains comprehensive unit tests that verify both valid and invalid content structures for every section in the corresponding family.           | N/A                                      |
| AC-6 | A main barrel file `src/doc-parser/validation/index.ts` is created, exporting all family-level schemas for easy consumption.                                    | `__tests__/index.test.ts`                |
| AC-7 | All schemas correctly parse valid content objects and reject non-compliant ones with informative errors, achieving 100% test coverage for the validation logic. | Vitest Coverage Report                   |
| AC-8 | End-to-end integration tests are created, validating complete mock markdown files (both valid and invalid) against the schemas.                                 | `__tests__/integration.test.ts`          |

---

## 3 Planning & Decomposition

### 3.3 Dependencies

| ID  | Dependency On                                                                   | Type     | Status         | Notes                                                                                                                    |
| :-- | :------------------------------------------------------------------------------ | :------- | :------------- | :----------------------------------------------------------------------------------------------------------------------- |
| D-1 | [T28: Define Canonical Schema Interfaces](./p1.t28-define-schema-types.task.md) | Internal | ðŸ’¡ Not Started | The base types for the schema definition itself are a prerequisite for creating strongly-typed content schemas.          |
| D-2 | A Markdown Parser (e.g., `remark`)                                              | External | âœ… Done        | The schemas must validate the output of the chosen parser. We will assume a standard AST structure produced by `remark`. |

---

## 4 High-Level Design

### 4.2 Target Architecture

#### 4.2.1 Data Models

The Zod schemas will validate data structures representing parsed markdown content. The parser is expected to transform markdown elements into predictable object shapes. For example, a bulleted list of key-value pairs becomes an object, and a table becomes an array of objects.

```mermaid
erDiagram
    SECTION_CONTENT {
        string type
        any content
    }
    ZOD_SCHEMA {
        object definition
    }
    PARSED_OBJECT {
        string key
        string value
    }
    PARSED_TABLE {
        array rows
    }

    SECTION_CONTENT ||--o{ PARSED_OBJECT : "can be"
    SECTION_CONTENT ||--o{ PARSED_TABLE : "can be"
    ZOD_SCHEMA ||--|| SECTION_CONTENT : "validates"
```

#### 4.2.2 Components

The architecture is composed of multiple schema modules, one for each documentation family. A central barrel file (`index.ts`) aggregates these modules for easy consumption.

```mermaid
classDiagram
    direction LR

    class Family1 {
        <<Module>>
        "1-meta-governance.schema.ts"
        +metaGovernanceSchema: ZodObject
    }
    class Family2 {
        <<Module>>
        "2-business-scope.schema.ts"
        +businessScopeSchema: ZodObject
    }
    class Family3 {
        <<Module>>
        "3-planning-decomposition.schema.ts"
        +planningDecompositionSchema: ZodObject
    }
    class Family4 {
        <<Module>>
        "4-high-level-design.schema.ts"
        +highLevelDesignSchema: ZodObject
    }
    class Family5 {
        <<Module>>
        "5-maintenance-monitoring.schema.ts"
        +maintenanceMonitoringSchema: ZodObject
    }
    class Family6 {
        <<Module>>
        "6-implementation-guidance.schema.ts"
        +implementationGuidanceSchema: ZodObject
    }
    class Family7 {
        <<Module>>
        "7-quality-operations.schema.ts"
        +qualityOperationsSchema: ZodObject
    }
    class Family8 {
        <<Module>>
        "8-reference.schema.ts"
        +referenceSchema: ZodObject
    }

    class ValidationIndex {
        <<Module: index.ts>>
        +metaGovernanceSchema
        +businessScopeSchema
        +planningDecompositionSchema
        +highLevelDesignSchema
        +maintenanceMonitoringSchema
        +implementationGuidanceSchema
        +qualityOperationsSchema
        +referenceSchema
    }

    ValidationIndex ..> Family1 : exports
    ValidationIndex ..> Family2 : exports
    ValidationIndex ..> Family3 : exports
    ValidationIndex ..> Family4 : exports
    ValidationIndex ..> Family5 : exports
    ValidationIndex ..> Family6 : exports
    ValidationIndex ..> Family7 : exports
    ValidationIndex ..> Family8 : exports
```

#### 4.2.3 Data Flow

Not applicable. This task is focused on creating a schema library, which does not have an internal data flow. The data flow belongs to the consumer of the library.

#### 4.2.4 Control Flow

Not applicable. The control flow is owned by the consumer that imports and executes the schemas.

### 4.3 Tech Stack & Deployment

- **Language**: TypeScript
- **Schema Validation**: Zod
- **Testing**: Vitest
- **Deployment**: The schemas will be part of the `@livelifelively/ddd-tools` internal package, located in the `src/doc-parser/validation/` directory.

### 4.4 Non-Functional Requirements

#### 4.4.1 Performance

| ID      | Requirement                                                                   | Priority |
| :------ | :---------------------------------------------------------------------------- | :------- |
| PERF-01 | Schema validation should be fast enough for interactive use (e.g., git-hook). | ðŸŸ¥ High  |

#### 4.4.2 Security

| ID     | Requirement                                                          | Priority |
| :----- | :------------------------------------------------------------------- | :------- |
| SEC-01 | Schemas must not execute any untrusted code from the parsed content. | ðŸŸ¥ High  |

---

## 5 Maintenance and Monitoring

### 5.2 Target Maintenance and Monitoring

#### 5.2.1 Error Handling

| Error Type                    | Trigger                                                                | Action                   | Consumer Feedback                                                                      |
| :---------------------------- | :--------------------------------------------------------------------- | :----------------------- | :------------------------------------------------------------------------------------- |
| **Schema Validation Failure** | A consumer calls `schema.parse()` with a non-compliant content object. | Zod throws a `ZodError`. | The `ZodError` object contains detailed information about the validation failure.      |
| **Schema Import Failure**     | A consumer attempts to import a non-existent schema from the library.  | Runtime throws an error. | Standard module-not-found error from the runtime environment (e.g., Node.js, bundler). |

#### 5.2.2 Logging & Monitoring

- **Logging**: Not applicable. As a static library, this system does not perform logging. The consuming tool is responsible for logging validation results.
- **Monitoring**: Not applicable. The consuming tool is responsible for any monitoring related to schema validation.

---

## 6 Implementation Guidance

### 6.1 Implementation Log / Steps

- [ ] Create the main directory `src/doc-parser/validation/`.
- [ ] Create the main directory `src/doc-parser/validation/`.
- [ ] Create the test directory `src/doc-parser/validation/__tests__/`.
- [ ] **Family 1: Meta & Governance**
  - [ ] Create `src/doc-parser/validation/1-meta-governance.schema.ts`.
  - [ ] Create `src/doc-parser/validation/__tests__/1-meta-governance.schema.test.ts`.
  - [ ] Implement and test schemas for all sections in Family 1.
- [ ] **Family 2: Business & Scope**
  - [ ] Create `src/doc-parser/validation/2-business-scope.schema.ts`.
  - [ ] Create `src/doc-parser/validation/__tests__/2-business-scope.schema.test.ts`.
  - [ ] Implement and test schemas for all sections in Family 2.
- [ ] **Family 3: Planning & Decomposition**
  - [ ] Create `src/doc-parser/validation/3-planning-decomposition.schema.ts`.
  - [ ] Create `src/doc-parser/validation/__tests__/3-planning-decomposition.schema.test.ts`.
  - [ ] Implement and test schemas for all sections in Family 3.
- [ ] **Family 4: High-Level Design**
  - [ ] Create `src/doc-parser/validation/4-high-level-design.schema.ts`.
  - [ ] Create `src/doc-parser/validation/__tests__/4-high-level-design.schema.test.ts`.
  - [ ] Implement and test schemas for all sections in Family 4.
- [ ] **Family 5: Maintenance and Monitoring**
  - [ ] Create `src/doc-parser/validation/5-maintenance-monitoring.schema.ts`.
  - [ ] Create `src/doc-parser/validation/__tests__/5-maintenance-monitoring.schema.test.ts`.
  - [ ] Implement and test schemas for all sections in Family 5.
- [ ] **Family 6: Implementation Guidance**
  - [ ] Create `src/doc-parser/validation/6-implementation-guidance.schema.ts`.
  - [ ] Create `src/doc-parser/validation/__tests__/6-implementation-guidance.schema.test.ts`.
  - [ ] Implement and test schemas for all sections in Family 6.
- [ ] **Family 7: Quality & Operations**
  - [ ] Create `src/doc-parser/validation/7-quality-operations.schema.ts`.
  - [ ] Create `src/doc-parser/validation/__tests__/7-quality-operations.schema.test.ts`.
  - [ ] Implement and test schemas for all sections in Family 7.
- [ ] **Family 8: Reference**
  - [ ] Create `src/doc-parser/validation/8-reference.schema.ts`.
  - [ ] Create `src/doc-parser/validation/__tests__/8-reference.schema.test.ts`.
  - [ ] Implement and test schemas for all sections in Family 8.
- [ ] **Integration Testing**
  - [ ] Create a directory `src/doc-parser/validation/__tests__/mocks/` for mock markdown files.
  - [ ] Create at least one valid and one invalid mock `*.task.md` file.
  - [ ] Create the integration test file `src/doc-parser/validation/__tests__/integration.test.ts`.
  - [ ] Implement tests that parse the mock files and validate their content against the schemas.
- [ ] **Finalization**
  - [ ] Create the barrel file `src/doc-parser/validation/index.ts` to export all family-level schemas.
  - [ ] Create a test file `src/doc-parser/validation/__tests__/index.test.ts` to ensure all exports are present.

---

## 7 Quality & Operations

### 7.1 Testing Strategy / Requirements

| AC   | Scenario                                                                                               | Test Type   | Tools / Runner | Notes                                                                                                             |
| :--- | :----------------------------------------------------------------------------------------------------- | :---------- | :------------- | :---------------------------------------------------------------------------------------------------------------- |
| AC-5 | Each `[family-name].schema.test.ts` file validates all section schemas within that family.             | Unit        | Vitest         | Tests should cover both "golden path" (valid data) and failure cases (invalid data, missing fields, wrong types). |
| AC-7 | The test suite achieves 100% line and branch coverage for all `*.schema.ts` files.                     | Coverage    | Vitest         | This ensures that every validation rule and logic path is tested.                                                 |
| AC-6 | The `index.test.ts` file verifies that all family-level schemas are correctly exported from the index. | Unit        | Vitest         | This test prevents accidental omission of a family schema from the main entry point.                              |
| AC-8 | The `integration.test.ts` file validates mock markdown files against the entire schema library.        | Integration | Vitest         | This provides end-to-end confidence in the absence of dedicated QA.                                               |

### 7.5 Local Test Commands

```bash
# Run all validation schema tests (unit and integration) and view coverage
npm test -- --coverage src/doc-parser/validation/
```

---

## 8 Reference

### 8.1 Appendices/Glossary

- **Zod**: The schema validation library used to define the content structure rules.
- **AST (Abstract Syntax Tree)**: The tree representation of the parsed markdown content that the schemas will validate.
- **Consumer**: Any tool or script that imports and uses this schema library for validation (e.g., a linter, a git-hook script).
