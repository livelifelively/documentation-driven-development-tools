# DDD Tools: Schema Definition & Generation System

## 1 Meta & Governance

### 1.2 Status

- **Created:** 2025-07-20 01:58
- **Last Updated:** 2025-07-20 01:58

### 1.3 Priority Drivers

- TEC-Dev_Productivity_Enhancement
- TEC-Dev_Productivity_Blocker

---

## 2 Business & Scope

### 2.1 Overview

- **Core Function**: Provides the canonical schema definition and automated generation system for Documentation-Driven Development methodology structure.
- **Key Capability**: Transforms JSON-based schema definitions into consistent documentation templates and schema references, ensuring all DDD projects follow identical structural patterns.
- **Business Value**: Eliminates manual template maintenance and enables teams to adopt DDD methodology with guaranteed structural consistency across all documentation.

### 2.2 Business Context

The Documentation-Driven Development methodology requires strict structural consistency across all project documentation to enable automation, validation, and tooling integration. Previously, template maintenance was manual and prone to drift between projects.

This system establishes a schema-as-code approach where the canonical DDD structure is defined once in JSON and automatically generates all downstream artifacts (templates, documentation, examples). This ensures structural consistency while enabling methodology evolution through versioned schema updates.

#### 2.2.1 User Journeys

##### 2.2.1.1 Journey: DDD Methodology Maintainer Updates Structure

A methodology maintainer needs to modify the DDD documentation structure (add new sections, change requirements, update examples).

```mermaid
sequenceDiagram
    participant Maintainer
    participant JSONSchema
    participant Generator
    participant Templates
    participant Documentation

    Maintainer->>JSONSchema: Modifies family definitions
    Maintainer->>Generator: Runs generation scripts
    Generator->>Templates: Generates plan.template.md
    Generator->>Templates: Generates task.template.md
    Generator->>Documentation: Generates schema docs (human/machine)
    Generator-->>Maintainer: All artifacts updated consistently
```

##### 2.2.1.2 Journey: Developer Creates New DDD Project

A developer needs to start a new project using current DDD methodology structure.

```mermaid
graph LR
    A["Developer needs<br/>DDD structure"] --> B["Access generated<br/>templates"]
    B --> C["Create project docs<br/>using templates"]
    C --> D["Follow schema<br/>documentation"]
    D --> E["Consistent DDD<br/>implementation"]
```

#### 2.2.2 User Personas

| Persona                        | Goal                                                                                     |
| :----------------------------- | :--------------------------------------------------------------------------------------- |
| **DDD Methodology Maintainer** | Evolve and maintain the canonical DDD structure definition with automated consistency.   |
| **Project Developer**          | Create new DDD-compliant projects using current methodology templates and documentation. |
| **LLM Integration**            | Parse and understand DDD structure through machine-optimized schema documentation.       |

#### 2.2.3 Core Business Rules

- **Schema as Single Source of Truth**: All documentation structure must derive from JSON schema definitions - no manual template editing.
- **Automated Generation**: All templates and documentation must be generated programmatically to ensure consistency.
- **Dual-Mode Support**: Must support both human-readable and machine-optimized outputs for different consumption patterns.
- **Type Safety**: All generation must be compile-time type-safe to prevent structural errors.

#### 2.2.4 User Stories

- As a **DDD Methodology Maintainer**, I want to modify schema definitions in JSON so that all templates and documentation update automatically with guaranteed consistency.
- As a **Project Developer**, I want to access current DDD templates so that I can start new projects with the latest methodology structure.
- As an **LLM Integration**, I want machine-optimized schema documentation so that I can understand and validate DDD document structures programmatically.

### 2.3 Success Criteria

- **Automated Template Generation**: plan.template.md and task.template.md are generated automatically from JSON schema with 100% consistency.
- **Dual-Mode Documentation**: Both human-readable and machine-optimized schema documentation are generated automatically from the same source.
- **Type-Safe Generation**: All generation processes compile without TypeScript errors and produce valid markdown output.
- **Schema Coverage**: All 8 information families are properly defined in JSON and correctly rendered in all output formats.

### 2.5 Boundaries & Scope

#### 2.5.1 In Scope

- **JSON Schema Definition System**: Canonical definition of DDD documentation structure using 8 information families.
- **Template Generation Engine**: Automated creation of plan.template.md and task.template.md from schema definitions.
- **Documentation Generation Engine**: Automated creation of schema documentation in human and machine-readable formats.
- **Type-Safe Rendering**: TypeScript-based rendering system ensuring compile-time validation of all generated content.

#### 2.5.2 Out of Scope

- **Project Creation Tools**: Command-line tools for initializing new DDD projects (deferred to future iterations).
- **Validation Tools**: Schema compliance checking for existing documentation (deferred to future iterations).
- **Multi-Language Support**: Schema bindings for languages other than TypeScript (deferred to future iterations).
- **Live Documentation**: Dynamic or interactive documentation features (deferred to future iterations).

### 2.6 Core Business Processes

#### 2.6.1 Process: Schema-Driven Generation

- **Participants**: DDD Methodology Maintainer, Generation System
- **Goal**: Update all DDD artifacts consistently when schema changes
- **Workflow**:
  1. Maintainer modifies JSON schema files in `src/ddd-schema-json/`
  2. System validates TypeScript compilation for type safety
  3. Maintainer runs `npm run generate-templates` to update templates
  4. Maintainer runs `npm run generate-schema-doc` to update documentation
  5. All downstream artifacts are updated with guaranteed consistency

---

## 3 Planning & Decomposition

### 3.1 Roadmap (In-Focus Items)

| ID      | Child Plan/Task         | Priority | Priority Drivers                 | Status         | Depends On | Summary                                                           |
| :------ | :---------------------- | :------- | :------------------------------- | :------------- | :--------- | :---------------------------------------------------------------- |
| Current | Document Current System | ðŸŸ¥ High  | TEC-Dev_Productivity_Enhancement | â³ In Progress | â€”          | Document existing capabilities as foundation for future planning. |

### 3.2 Backlog / Icebox

- **CLI Tools**: Command-line interface for project initialization and schema validation
- **Template Customization**: Support for project-specific template variations
- **Schema Versioning**: Semantic versioning and migration tools for schema evolution
- **IDE Integration**: VSCode extensions for real-time DDD compliance checking

### 3.3 Dependencies

| ID  | Dependency On   | Type     | Status      | Affected Plans/Tasks | Notes                                                     |
| :-- | :-------------- | :------- | :---------- | :------------------- | :-------------------------------------------------------- |
| D-1 | TypeScript 5.0+ | External | âœ… Complete | All generation       | Required for type safety and modern language features.    |
| D-2 | Node.js 18+     | External | âœ… Complete | All scripts          | Required for script execution and file system operations. |

### 3.4 Decomposition Graph

```mermaid
graph TB
    A["DDD Schema System"] --> B["JSON Schema Definitions"]
    A --> C["TypeScript Generation Engine"]
    A --> D["Template Generation"]
    A --> E["Documentation Generation"]

    B --> B1["8 Information Families"]
    B --> B2["Context Examples"]

    C --> C1["Type Definitions"]
    C --> C2["Rendering Engine"]
    C --> C3["Content Conversion"]

    D --> D1["Plan Templates"]
    D --> D2["Task Templates"]

    E --> E1["Human-Readable Docs"]
    E --> E2["Machine-Readable Docs"]
```

---

## 4 High-Level Design

### 4.0 Guiding Principles

- **Schema as Source of Truth**: All structure and content templates derive from JSON schema definitions with zero manual override capability.
- **Type-Safe Generation**: All rendering and generation must be compile-time validated through TypeScript type system.
- **Dual-Mode Architecture**: System must support both human-optimized and machine-optimized output formats from the same source.
- **Automated Consistency**: No manual template maintenance - all artifacts generated programmatically to ensure structural consistency.

### 4.1 Current Architecture

#### 4.1.1 Data Models

**Core Schema Structure:**

```typescript
interface SchemaFamily {
  id: number;
  name: string;
  anchor: string;
  primaryQuestion: string;
  rationale: string;
  applicability: SchemaApplicability;
  notes: string;
  sections: SchemaSection[];
}

interface SchemaSection {
  id: string;
  name: string;
  headingLevel: number;
  description?: string;
  applicability: SchemaApplicability;
  examples?: SchemaExample[];
}
```

**Rendering Control:**

```typescript
interface ContentElement {
  type: 'text' | 'list' | 'table' | 'codeblock' | 'mermaid';
  rendering: RenderingControl;
}

interface RenderingControl {
  renderAsCodeBlockForHuman: boolean;
  renderAsCodeBlockForMachine: boolean;
}
```

#### 4.1.2 Components

```mermaid
graph TB
    subgraph "JSON Schema Layer"
        A["8 Family JSON Files"]
        B["Context Examples"]
    end

    subgraph "TypeScript Engine"
        C["Schema Loader"]
        D["Type Definitions"]
        E["Rendering Engine"]
        F["Content Converter"]
    end

    subgraph "Generation Scripts"
        G["Template Generator"]
        H["Documentation Generator"]
    end

    subgraph "Output Artifacts"
        I["plan.template.md"]
        J["task.template.md"]
        K["schema.human.md"]
        L["schema.machine.md"]
    end

    A --> C
    B --> C
    C --> D
    D --> E
    E --> F
    F --> G
    F --> H
    G --> I
    G --> J
    H --> K
    H --> L
```

#### 4.1.3 Data Flow

1. **Schema Loading**: JSON files loaded as TypeScript interfaces for compile-time validation
2. **Content Processing**: Schema sections converted to structured content elements with rendering controls
3. **Mode-Specific Rendering**: Content rendered differently for human vs machine consumption
4. **Template Generation**: Complete markdown templates assembled with proper structure and examples
5. **Documentation Generation**: Schema documentation rendered in dual modes from the same source

#### 4.1.4 Control Flow

**Template Generation Process:**

1. Load schema families from JSON files
2. Build document structure based on plan/task applicability matrix
3. Generate markdown sections with appropriate heading levels
4. Insert examples and descriptions from schema definitions
5. Write complete templates to docs/templates/

**Documentation Generation Process:**

1. Load schema families and build family index table
2. For each family, generate depth matrix showing section hierarchy
3. Render examples in mode-specific format (human: blockquotes, machine: code blocks)
4. Assemble complete documentation with navigation and structure
5. Write dual-mode files to generated-schema-docs/

#### 4.1.5 Integration Points

**Input Interfaces:**

- JSON schema files (`src/ddd-schema-json/*.json`)
- TypeScript type definitions (`src/types.ts`)

**Output Interfaces:**

- Markdown templates (`docs/templates/*.template.md`)
- Schema documentation (`src/generated-schema-docs/*.md`)
- Generated documentation copied to `docs/` directory

#### 4.1.6 Exposed API

**Public Functions (exported from index.ts):**

```typescript
// Template generation
export function generatePlanTemplate(): string;
export function generateTaskTemplate(): string;

// Documentation generation
export function generateHumanSchemaDocumentation(): string;
export function generateMachineSchemaDocumentation(): string;

// Schema access
export const fullSchema: SchemaFamily[];
```

### 4.2 Target Architecture

**Current architecture is the target architecture.** The system is designed for its current scope and implements the intended schema-driven generation approach effectively.

### 4.3 Tech Stack & Deployment

**Runtime Environment:**

- **Node.js 18+**: Script execution and file system operations
- **TypeScript 5.0+**: Type safety and modern language features

**Development Dependencies:**

- **Jest**: Unit testing framework
- **tsx**: TypeScript execution for development scripts

**Deployment:**

- **Local Development**: Scripts run locally via npm commands
- **File System Output**: Generated files written directly to project directories
- **Version Control**: All generated artifacts committed to repository for consistency

### 4.4 Non-Functional Requirements

#### 4.4.1 Performance

| Requirement                   | Target                    | Current Status |
| :---------------------------- | :------------------------ | :------------- |
| Template Generation Time      | < 1 second                | âœ… Met         |
| Documentation Generation Time | < 2 seconds               | âœ… Met         |
| Memory Usage                  | < 100MB during generation | âœ… Met         |

#### 4.4.2 Reliability

| Requirement            | Target                                     | Current Status |
| :--------------------- | :----------------------------------------- | :------------- |
| Type Safety            | 100% compile-time validation               | âœ… Met         |
| Generation Consistency | Identical output for identical input       | âœ… Met         |
| Error Handling         | Graceful failure with clear error messages | âœ… Met         |

#### 4.4.3 Scalability

| Requirement           | Target                             | Current Status      |
| :-------------------- | :--------------------------------- | :------------------ |
| Schema Family Support | 8+ families                        | âœ… Met (8 families) |
| Section Nesting       | 5+ levels deep                     | âœ… Met              |
| Example Complexity    | Multiple content types per section | âœ… Met              |

#### 4.4.4 Permission Model

**Not applicable** - this is a local development tool with no user authentication or access control requirements.

---

## 5 Maintenance and Monitoring

### 5.1 Current Maintenance and Monitoring

#### 5.1.1 Error Handling

| Error Type                       | Trigger                                   | Action                            | User Feedback                                                 |
| :------------------------------- | :---------------------------------------- | :-------------------------------- | :------------------------------------------------------------ |
| **TypeScript Compilation Error** | Invalid schema structure or type mismatch | Abort generation with exit code 1 | Clear compilation error message with file and line references |
| **JSON Schema Validation Error** | Malformed JSON in schema files            | Abort generation with exit code 1 | JSON parsing error with specific file and location            |
| **File System Error**            | Cannot write to output directories        | Abort generation with exit code 1 | Clear file system error with path and permissions information |

#### 5.1.2 Logging & Monitoring

- **Console Output**: Structured progress messages during generation processes
- **Error Reporting**: Detailed error messages with context for debugging
- **Success Confirmation**: Clear confirmation messages with output file paths
- **No External Monitoring**: System runs locally with immediate feedback

### 5.2 Target Maintenance and Monitoring

**Current monitoring approach is appropriate for the system scope.** No external monitoring or complex error handling is needed for a local development tool.

---

## 6 Implementation Guidance

### 6.1 Implementation Plan

**Current system is fully implemented.** This section documents the implementation approach used:

1. **Schema Definition**: JSON files created for each information family with complete section definitions
2. **Type System**: TypeScript interfaces created to ensure compile-time validation
3. **Rendering Engine**: Flexible rendering system built to support multiple output modes
4. **Generation Scripts**: Automated scripts created for template and documentation generation

### 6.2 Prompts (LLM reuse)

**For extending the schema system:**

```markdown
Add a new section to family [X] that [describes functionality]. Follow the existing pattern in src/ddd-schema-json/[X]-[name].json and ensure the section includes:

- Proper applicability matrix for plan/task
- Descriptive examples with rendering controls
- Clear content format specification
```

**For troubleshooting generation:**

```markdown
Debug the generation system by:

1. Running TypeScript compilation: npm run build
2. Checking JSON syntax in src/ddd-schema-json/
3. Verifying output directories exist and are writable
4. Running generation scripts individually to isolate issues
```

---

## 7 Quality & Operations

### 7.1 Testing Strategy / Requirements

| Test Type             | Coverage                    | Tools / Runner      | Status         |
| :-------------------- | :-------------------------- | :------------------ | :------------- |
| **Unit Tests**        | Core rendering functions    | Jest                | ðŸ’¡ Not Started |
| **Integration Tests** | End-to-end generation       | Jest                | ðŸ’¡ Not Started |
| **Type Checking**     | Full TypeScript compilation | TypeScript compiler | âœ… Complete    |
| **Output Validation** | Generated markdown syntax   | Manual review       | âœ… Complete    |

### 7.2 Configuration

| Setting Name      | Source                               | Override Method            | Notes                                                       |
| :---------------- | :----------------------------------- | :------------------------- | :---------------------------------------------------------- |
| `outputDirectory` | Hard-coded in scripts                | Manual script modification | Controls where generated files are written                  |
| `schemaDirectory` | Hard-coded as `src/ddd-schema-json/` | Manual script modification | Location of JSON schema source files                        |
| `NODE_ENV`        | Environment Variable                 | Not overrideable           | Development vs production mode (currently development only) |

### 7.3 Alerting & Response

| Error Condition                  | Response Plan                                         | Status      |
| :------------------------------- | :---------------------------------------------------- | :---------- |
| **Generation Script Failure**    | Abort with non-zero exit code and clear error message | âœ… Complete |
| **TypeScript Compilation Error** | Display compiler errors and abort generation          | âœ… Complete |
| **File System Permission Error** | Log specific path and permission requirements         | âœ… Complete |

### 7.4 Deployment Steps

**For normal development:**

1. Make changes to JSON schema files in `src/ddd-schema-json/`
2. Run `npm run generate-templates` to update templates
3. Run `npm run generate-schema-doc` to update documentation
4. Commit all generated files to version control

**For major schema changes:**

1. Update JSON schema files with new structure
2. Update TypeScript types if needed
3. Test compilation: `npm run build`
4. Regenerate all artifacts
5. Review generated output for correctness
6. Update this documentation if architecture changes

---

## 8 Reference

### 8.1 Appendices/Glossary

**Glossary:**

- **Schema Family**: One of 8 major categories of information in DDD documents (Meta, Business, Planning, Design, Maintenance, Implementation, Quality, Reference)
- **Applicability Matrix**: Defines which sections are required/optional/omitted for Plans vs Tasks
- **Rendering Control**: Configuration determining how examples appear in human vs machine-readable output
- **Dual-Mode**: System capability to generate both human-optimized and machine-optimized documentation from the same source

**Key File References:**

- `src/index.ts`: Main generation engine and exported API
- `src/ddd-schema-json/`: JSON schema definitions (single source of truth)
- `src/types.ts`: TypeScript type definitions for schema structure
- `package.json`: Available scripts and dependencies

---
